function getDetailpageMainVisual(){var t="/api/product/"+$(location).attr("pathname").slice(-1);$.ajax({url:t,method:"GET"}).done(function(t,e){_productId=t.productDetail.id;t.productDetail.name;for(var o=[],n=0;n<t.images.length;n++){var i="/files/"+t.images[n];o[n]={title:t.productDetail.name,dsc:t.productDetail.description,image:i}}var a=productDetailTemplate(o);$(".visual_img").append(a),$(".store_details .dsc").text(t.productDetail.description),null===t.productDetail.event?$(".section_event").hide():$(".event_info .in_dsc").text(t.productDetail.event);$(".detail_info_group .in_dsc").text(t.productDetail.content);$(".box_store_info").append(storeLocationInfoTemplate(t.productDetail)),$(".group_btn_goto").append(groupBtnTemplate(t.productDetail)),titleModule.init()}).fail(function(t,e){})}function getUserCommentCommonInfo(){var t=$(location).attr("pathname").slice(-1);$.ajax({url:"/api/comment/commoninfo/"+t,method:"GET"}).done(function(t,e){var o=t.avgScore.toFixed(1),n=o/5*100;result={count:t.count,avgScore:o,percentScore:n},$(".grade_area").append(commonInfoTemplate(result))}).fail(function(t,e){})}function getComment(){var t="/api/comment?productid="+$(location).attr("pathname").slice(-1)+"&limit=3&offset=0";$.ajax({url:t,method:"GET"}).done(function(t,e){var o=t.fileIdDto,n=t.userComment;result=[];for(var i=[],a=0;a<o.length;a++)i[o[a].userId]=[];for(a=0;a<o.length;a++)i[o[a].userId].push(o[a].id);for(var r="",a=0;a<n.length;a++)r=void 0!==i[a]?"/files/"+i[a][0]:0,result[a]={comment:n[a].comment,createDate:n[a].createDate,id:n[a].id,score:n[a].score.toFixed(1),userId:n[a].userId,images:i[a],firstImage:r};$(".list_short_review").append(commentTemplate(result))}).fail(function(t,e){})}function getStaticNaverMapImage(){var t=encodeURI("서울특별시 노원구 월계동 411-3");$.ajax({url:"/api/map/"+t,method:"GET"}).done(function(t,e){var o=$("#store_location").html(),n=Handlebars.compile(o),i={x:t.location.items[0].point.x,y:t.location.items[0].point.y};$(".store_location").append(n(i))}).fail(function(t,e){})}function getCategories(){var t=$("#category_list").html();$.ajax({url:"/api/categories",method:"GET"}).done(function(e){var o=Handlebars.compile(t)(e);$(".section_event_tab").find("ul").append(o)})}function getProductCount(){$.ajax({url:"./api/productlist/count/0",method:"GET"}).done(function(t){var e=t+"개";$(".event_lst_txt > .pink").text(e)})}function getProducts(){productModule.setOffset();var t=productModule.getOption(),e="./api/productlist?limit="+t.limit+"&offset="+t.offset+"&categoryId=0";$.ajax({url:e,method:"GET"}).done(function(t){divideProduct(t),productModule.runCompile(),$(".wrap_event_box > .lst_event_box:first").append(productModule.getObject().leftHtml),$(".wrap_event_box > .lst_event_box:last").append(productModule.getObject().rightHtml),productModule.cleanProduct()})}function getProductByCategory(t){productModule.setOffset();var e=productModule.getOption(),o="./api/productlist?limit="+e.limit+"&offset="+e.offset+"&categoryId="+t;$.ajax({url:o,method:"GET"}).done(function(t){divideProduct(t),productModule.runCompile(),$(".wrap_event_box > .lst_event_box:first").append(productModule.getObject().leftHtml),$(".wrap_event_box > .lst_event_box:last").append(productModule.getObject().rightHtml),productModule.cleanProduct()})}function divideProduct(t){for(var e=0;e<t.length;e++){var o="/files/"+t[e].fileId;e%2==0?productModule.getObject().leftItem.push({id:t[e].id,name:t[e].name,image:o,placeName:t[e].placeName,content:t[e].content}):productModule.getObject().rightItem.push({id:t[e].id,name:t[e].name,image:o,placeName:t[e].placeName,content:t[e].content})}}function truncateProductList(){var t=$(".wrap_event_box > .lst_event_box:first-child"),e=t.next();t.empty(),e.empty()}function Display(){}function Subject(){}function productSummary(t){var e=t.titleImage,o=t.priceInfo,n=t.displayInfo,i=["(일)","(월)","(화)","(수)","(목)","(금)","(토)"];$(".title").text(n.name),null!==e&&$(".visual_img img").prop("src","/files/"+e.fileId),$(".preview_txt_tit").text(n.name),$(".preview_txt em:first").text("₩"+o[0].price.toLocaleString()+" ~ ");var a=new Date(n.salesStart),r=new Date(n.salesEnd),l=n.salesStart+i[a.getDay()]+" ~ "+n.salesEnd+i[r.getDay()];$(".preview_txt em:last").text(l);var c=$(".store_details .in_tit"),u=$(".store_details .dsc");$(c[0]).text(n.name),$(u[0]).html("장소 : "+n.placeName+"<br>기간 : "+l),$(c[1]).text("관람시간"),$(u[1]).html(n.observationTime),$(c[2]).text("요금");for(var s="",d=0;d<o.length;d++)1===o[d].priceType?s+="성인(만 19~64세) ":2===o[d].priceType?s+="청소년(만 13~18세) ":3===o[d].priceType&&(s+="유아(만 4~12세) "),s+=o[d].price.toLocaleString()+"원 ",d%2==0&&d+1!==o.length?s+="/ ":d%2==1&&d+1!==o.length&&(s+="<br>");$(u[2]).html(s)}function reservationTicketArea(t){for(var e=$("#ticket-list").html(),o=Handlebars.compile(e),n=[],i="",a="",r=0;r<t.length;r++)i=1===t[r].priceType?"성인":2===t[r].priceType?"청소년":3===t[r].priceType?"유아":"기타",a=t[r].price*(1-t[r].discountRate.toFixed(1)),n[r]={type:t[r].priceType,priceType:i,price:t[r].price.toLocaleString(),actualPrice:a,discountPrice:a.toLocaleString(),discountRate:100*t[r].discountRate};$(".ticket_body").append(o(n))}function agreementArea(){$(".section_booking_agreement").on("click",".btn_agreement",function(){$(this).closest(".agreement").toggleClass("open")}),$(".chk_agree").on("click",function(){$(".chk_agree").hasClass("checked")?($(".chk_agree").removeClass("checked"),$(".bk_btn_wrap").addClass("disable")):($(".chk_agree").addClass("checked"),$(".bk_btn_wrap").removeClass("disable"))})}function reservationButtonArea(){$(".bk_btn_wrap").on("click",function(){if(!$(this).hasClass("disable")){var t=/^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;if(!/^\d{3}-\d{3,4}-\d{4}$/.test($("#tel").val()))return;if(!t.test($("#email").val()))return}})}function hello(){}!function(t){function e(t){$.ajax({url:"/api/categories"+t,method:"DELETE",dataType:"json"}).done(function(e,o){var n="#"+t;$(n).remove()}).fail(function(t,e){})}function o(t,e){var o="/api/categories"+t,n=$("<form></form>");n.attr("action",o),n.attr("method","POST"),n.appendTo("body");var i='<input name="uvalue" type="hidden" value="'+e.val()+'"/>',a=$(i);n.append(a),n.submit()}$(".category-list").on("click",".delete",function(){e($(this).parents(".category").attr("id"))}),$(".category-list").on("click",".update",function(){var t=$(this).parents(".category").attr("id"),e=$("#update_val"),n=$("#cat").html();""!=e.val()&&n!=e.val()?(o(t,e),e.val("")):e.val("")})}(window);var carouselModule=function(){function t(){var t=0,e=null,o=500;return{ready:function(o){t=(e=o).find("li:last").width();var n=e.find("li:last").clone();e.prepend(n),e.css({left:-t})},movePrev:function(){null!==e&&e.stop(!0,!0).animate({left:0},{duration:o,complete:function(){e.find("li:last").remove();var o=e.find("li:last").clone();e.prepend(o),e.css({left:-t})}})},moveNext:function(){null!==e&&e.stop(!0,!0).animate({left:2*-t},{duration:o,complete:function(){e.find("li:first").remove();var o=e.find("li:first").clone();e.append(o),e.css({left:-t})}})},getRootElement:function(){return e},duplicatedRootReady:function(o){t=(e=o).find("li:last").width()},getChildWidth:function(){return t}}}return{getInstance:function(){return t()}}}(),titleModule=function(){function t(){(s=carouselModule.getInstance()).ready($(".visual_img")),$(".prev_inn").on("click",o),$(".nxt_inn").on("click",n)}function e(){touchModule.initTouchModule(1,carouselModule.getInstance(),$(".visual_img")),$(".visual_img").bind("touchstart",touchModule.touchInit),$(".visual_img").bind("touchmove",touchModule.touchService),$(".visual_img").bind("touchend",i.bind(this))}function o(){--u<=0&&(u=l),s.movePrev(),c.text(u)}function n(){++u>l&&(u=1),s.moveNext(),c.text(u)}function i(t){var e=touchModule.touchEnd(t);(u+=e)<=0?u=l:u>l&&(u=1),c.text(u)}function a(){$(".figure_pagination span:last").text(l)}function r(){l<=1&&($(".btn_nxt").hide(),$(".btn_prev").hide())}var l=0,c="",u=1,s=null;return{init:function(){l=$(".visual_img li").length,c=$(".figure_pagination span:first"),r(),a(),l>1&&(t(),e())}}}(),placeLot="";$("._open").on("click",function(){$(".store_details").toggleClass("close3"),$("._open").hide(),$("._close").show()}),$("._close").on("click",function(){$(".store_details").toggleClass("close3"),$("._close").hide(),$("._open").show()});var touchModule=function(){var t=null,e=0,o=0,n=0;return{initTouchModule:function(e,o,n){t=o,0===e?t.ready(n):1===e&&t.duplicatedRootReady(n)},touchInit:function(t){o=t.touches[0].pageX,e=t.touches[0].pageY},touchService:function(i){var a=0,r=0,l=0,c=t.getChildWidth();a=i.touches[0].pageX-o,r=i.touches[0].pageY-e,n=a/c*100,Math.abs(a)>c&&(a=a<0?-c:c),l=a-c,Math.abs(a)>Math.abs(r)&&t.getRootElement().stop(!0,!0).animate({left:l},500)},touchEnd:function(i){var a=t.getChildWidth(),r=0;return Math.abs(n)>53?n<0?(t.moveNext(),r=1):(t.movePrev(),r=-1):t.getRootElement().stop(!0,!0).animate({left:-a},500),o=0,e=0,n=0,i.preventDefault(),r}}}();$(".info_tab_lst").on("click","li",function(){$(this).toggleClass("active")});var productDetailSource=$("#product_detail").html(),productDetailTemplate=Handlebars.compile(productDetailSource),storeLocationInfoSource=$("#store_location_info").html(),storeLocationInfoTemplate=Handlebars.compile(storeLocationInfoSource),groupBtnSource=$("#group_btn").html(),groupBtnTemplate=Handlebars.compile(groupBtnSource);$(".info_tab_lst").on("click",".anchor",function(t){$(this).closest("li").hasClass("_detail")?$(this).hasClass("active")||($(this).addClass("active"),$(this).closest("ul").find("._path a").removeClass("active"),$(".detail_area_wrap").removeClass("hide"),$(".detail_location").addClass("hide")):$(this).hasClass("active")||($(this).addClass("active"),$(this).closest("ul").find("._detail a").removeClass("active"),$(".detail_area_wrap").addClass("hide"),$(".detail_location").removeClass("hide"))});var commonInfoSource=$("#comment_commoninfo").html(),commonInfoTemplate=Handlebars.compile(commonInfoSource),commentSource=$("#comment_list").html(),commentTemplate=Handlebars.compile(commentSource),result=[],popupSource=$("#popup_image").html(),popupTemplate=Handlebars.compile(popupSource);$(".list_short_review").on("click",".thumb",function(t){var e=$(this).closest("li").data("comment");void 0===e&&0===e||(e-=1);for(var o=result[e],n=[],i=0;i<o.images.length;i++)n[i]={images:"/files/"+result[e].images[i]};$(".pop-layer .visual_pop").html(popupTemplate(n)),$(".dim-layer").fadeIn()}),$(".layer .dimBg").click(function(){$(".dim-layer").fadeOut()}),$(document).mouseup(function(t){0===$(".pop-layer").has(t.target).length&&$(".dim-layer").fadeOut()}),$(function(){getDetailpageMainVisual(),getUserCommentCommonInfo(),getComment(),getStaticNaverMapImage(),$(".section_btn").on("click",function(t){var e="/reserve/"+$(location).attr("pathname").slice(-1);window.location.href=e})}),$(window).on("load",function(){});var timerModule=function(){function t(){a=setInterval(i.moveNext,l)}function e(){null!=a&&(clearInterval(a),a=null)}function o(){r=setTimeout(t,l)}function n(){null!=r&&(clearTimeout(r),r=null)}var i=null,a=null,r=null,l=2e3;return{mouseEvent:function(){e(),n(),o()},initTimerModule:function(){(i=carouselModule.getInstance()).ready($(".visual_img"))},intervalSet:t,clickButton:function(o){e(),n(),o?i.movePrev():i.moveNext(),t()}}}();$(".btn_pre_e").mouseenter(timerModule.mouseEvent.bind(this)),$(".btn_nxt_e").mouseenter(timerModule.mouseEvent.bind(this)),$(".btn_pre_e").on("click",timerModule.clickButton.bind(this,!0)),$(".btn_nxt_e").on("click",timerModule.clickButton.bind(this,!1));var productModule=function(){var t=$("#lst_event_box_left").html(),e=$("#lst_event_box_right").html(),o=Handlebars.compile(t),n=Handlebars.compile(e),i={leftItem:[],rightItem:[],leftHtml:null,rightHtml:null},a={offset:null,limit:10};return{setOffset:function(){a.offset=$(".wrap_event_box").find("li").length},getObject:function(){return i},getOption:function(){return a},cleanProduct:function(){i.leftItem=[],i.rightItem=[],i.leftHtml=null,i.rightHtml=null},runCompile:function(){i.leftHtml=o(i.leftItem),i.rightHtml=n(i.rightItem)}}}();$(".event_tab_lst").on("click",".item",function(t){t.stopPropagation();var e=$(this).data("category"),o=$(this).parents(".section_event_tab").find(".active"),n=o.parents(".item").data("category");o.removeClass("active"),$(this).children(".anchor").addClass("active"),e!==n&&(truncateProductList(),0===e?getProducts():getProductByCategory(e))}),$(".more > .btn").on("click",function(){var t=$(".section_event_tab").find(".active").parents(".item").data("category");0===t?getProducts():getProductByCategory(t)}),$(window).scroll(function(){if($(window).scrollTop()===$(document).height()-$(window).height()){var t=$(".section_event_tab").find(".active").parents(".item").data("category");0===t?getProducts():getProductByCategory(t)}}),$(".wrap_event_box").on("click",".item_preview",function(t){var e="./detail/"+$(this).data("product");window.location.href=e}),$(function(){getCategories(),getProductCount(),getProducts()}),$(window).on("load",function(){timerModule.initTimerModule(),timerModule.intervalSet()}),Display.prototype=new eg.Component,Display.prototype.constructor=Display,Display.prototype.update=function(t,e,o){$(t.target).siblings(".count_control_input").val(e);var n=$(t.target).closest(".qty").find(".product_price").data("price")*e;$(t.target).closest(".qty").find(".total_price").text(n.toLocaleString()),this.displayTotalQty(o)},Display.prototype.displayTotalQty=function(t){var e=$(".inline_txt").text().split(",")[0],o=", 총 "+t+"매";$(".inline_txt").text(e+o)},Subject.prototype=new eg.Component,Subject.prototype.constructor=Subject,Subject.prototype.totalCount=0,Subject.prototype.display=new Display,Subject.prototype.setplus=function(t){var e=$(t.target).siblings(".count_control_input").val();e++,++this.totalCount>0&&$(t.target).siblings(".ico_minus3").removeClass("disabled"),this.notify(t,e,this.totalCount)},Subject.prototype.setminus=function(t){var e=$(t.target).siblings(".count_control_input").val();"0"!==e&&(0===--e&&$(t.target).addClass("disabled"),this.totalCount--,this.notify(t,e,this.totalCount))},Subject.prototype.registerPlusObserver=function(){this.on("plus",this.setplus)},Subject.prototype.registerMinusObserver=function(){this.on("minus",this.setminus)},Subject.prototype.unRegisterPlusObserver=function(){this.off("plus",this.setplus)},Subject.prototype.unRegisterMinusObserver=function(){this.off("minus",this.setminus)},Subject.prototype.init=function(){this.display.on("update",this.display.update)},Subject.prototype.notify=function(t,e,o){this.display.trigger("update",t,e,o)};var UserInfoInspectionModule=function(){var t=/^\d{3}-\d{3,4}-\d{4}$/,e=/^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;return{inspectTelNumber:function(){return!!t.test($("#tel").val())},inspectEmailAddress:function(){return!!e.test($("#email").val())}}}();$(function(){var t=$(location).attr("pathname").slice(-1);$.ajax({url:"/api/reserve/"+t,method:"GET"}).done(function(t,e){productSummary(t),reservationTicketArea(t.priceInfo)}).fail(function(t,e){}),agreementArea(),reservationButtonArea(),$(".btn_back").on("click",function(){history.back()});var e=new Subject;e.init(),e.registerPlusObserver(),e.registerMinusObserver(),$(".ticket_body").on("click",".btn_plus_minus",function(t){$(this).hasClass("ico_plus3")?e.trigger("plus",t):$(this).hasClass("ico_minus3")&&e.trigger("minus",t)})});